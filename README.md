# Тестовое задание от Indlab на позицию Python разработчика

## 1. Объединить коллабы, сделать обработку ошибок. Добавить проверку и удаление дубликатов в коллабе open-call_info.

Копия блокнота "open-call.ipynb"(https://colab.research.google.com/drive/17J-E2-oBq7DAK_FQz-tgtw6w7IYSQVNK?usp=sharing)
Копия блокнота "open_call_info.ipynb"(https://colab.research.google.com/drive/17J-E2-oBq7DAK_FQz-tgtw6w7IYSQVNK?usp=sharing)
Копия блокнота "open_calls_load.ipynb"(https://colab.research.google.com/drive/17J-E2-oBq7DAK_FQz-tgtw6w7IYSQVNK?usp=sharing)

Данные коллабы представляют из себя пайплайн по сбору данных, изменению данных и отправке данных в БД.
open-call - парсинг сайтов (может содержать блоки кода, которые не работали в окружении колаба, или 
требующие дополнительных данных - потребуется обработка ошибок)
open-call_info - обработка разноформатных данных через OpenAI, уточнение и приведение к общему 
формату и слияние в общий файл.
open_calls_load - загрузка данных в БД проекта


## 2. Внести изменения в мини-проект на FastAPI. Проект использует библиотеки Telethon и OpenAI для 
## работы с сообщениями пользователя в Telegram и их интеллектуальной обработки.

TELESUM_SOURCE(https://drive.google.com/drive/folders/1K_L0mbe8UzDs2d2IqDC7Dv-9YjlEbwjw?usp=sharing)

Задача
Создать функционал, который:
Читает все личные чаты пользователя в Telegram.
Автоматически отправляет новые входящие сообщения от собеседников на обработку в OpenAI (например, 
для генерации ответов, анализа текста или выполнения других задач).
Возвращает обработанный ответ в Telegram-чат с тем же собеседником, создавая впечатление, что 
пользователь отвечает в режиме реального времени.
Шаги для реализации изменений:
### 1. Чтение чатов пользователя
Настройте Telethon-клиент, чтобы подключиться к аккаунту Telegram.
Используйте метод get_dialogs() для получения списка всех чатов, включая личные сообщения, группы и каналы.
Настройте обработчик новых сообщений с помощью client.add_event_handler и события NewMessage.
### 2. Определение типа чата
Проверьте, является ли чат личным, используя атрибуты event.chat и event.is_private.
Извлеките информацию об отправителе (имя, фамилию, ID) из сообщения с помощью get_sender().
### 3. Отправка сообщения в OpenAI
Соберите текст нового сообщения из event.message.message.
Используйте OpenAI API для обработки текста. Это делается через метод openai.ChatCompletion.create, 
где вы передаете сообщение пользователя как ввод для модели.
### 4. Получение и обработка ответа
Сохраните сгенерированный OpenAI ответ.
Убедитесь, что ответ корректный (например, проверьте длину, отсутствие ошибок).
При необходимости обработайте текст ответа (например, удалите лишние символы или разметку).
### 5. Отправка ответа в Telegram
Используйте метод event.reply() для отправки OpenAI-ответа обратно в тот же чат.
Добавьте логирование (например, вывод в консоль), чтобы отслеживать, какие сообщения обработаны и отправлены.
## Ресурсы и ссылки:
Telethon:
Официальная документация: https://docs.telethon.dev
Гид по событиям: https://docs.telethon.dev/en/latest/modules/events.html
OpenAI API:
Официальная документация: https://platform.openai.com/docs
Инструкция для использования Chat API: https://platform.openai.com/docs/guides/chat
API-ключи Telegram:
Создание приложения для получения ключей: https://my.telegram.org

## Решения

## Задание №1

### Цель
Разработка автоматизированного пайплайна для сбора, обработки и загрузки данных о конкурсах для художников.

### Реализация
Процесс состоит из трех основных этапов:

1. **Сбор данных:**
   - Использованы библиотеки `requests` и `BeautifulSoup` для парсинга данных с сайта [artrabbit.com](https://artrabbit.com).
   - Обрабатываются заголовки и ссылки для сбора релевантной информации.
   - Добавлена обработка ошибок для предотвращения сбоев при запросах.

2. **Обработка данных:**
   - Данные приводятся к единому формату с использованием OpenAI API.
   - Проводится проверка на дубликаты и их удаление.
   - Учтены ограничения API: добавлены задержки между запросами для избежания превышения лимитов.

3. **Загрузка данных:**
   - Данные отправляются через `requests.post()` в API [https://beta.mirr.art/api/open_calls/](https://beta.mirr.art/api/open_calls/).
   - Реализована обработка ошибок для случаев недоступности сервера или некорректных ответов.

### Проблемы и ограничения
- **Отсутствие оплаченного API-ключа OpenAI:** Без платного ключа обработка данных невозможна. Возможное решение — использование альтернативных инструментов, таких как `spaCy` или `nltk`.
- **Изменения в структуре сайта:** Если сайт [artrabbit.com](https://artrabbit.com) изменит верстку, текущий парсинг может перестать работать. Решение — регулярное обновление логики парсинга.
- **Ограничения API:** OpenAI и API базы данных могут ограничивать количество запросов. Решение — кеширование данных и оптимизация запросов.

### Вывод
Процесс автоматизации сбора и обработки данных успешно реализован, но для полноценной работы требуется оплаченный API-ключ OpenAI или использование альтернативных инструментов. Также важно регулярно обновлять механизм парсинга для поддержания актуальности данных.

---

## Задание №2

### Цель
Интеграция обработки личных сообщений в Telegram с использованием OpenAI для анализа и генерации ответов.

### Реализация
- Использована библиотека `Telethon` для подключения к аккаунту пользователя и чтения личных чатов.
- Настроен обработчик событий для автоматической обработки новых сообщений.
- Подключен OpenAI API для анализа и генерации ответов.
- Реализовано логирование действий для упрощения отладки.
- Сохранен существующий функционал проекта, включая авторизацию и управление каналами.

### Сложности
- **Ограничения OpenAI:** Для полноценной работы требуется верификация с использованием зарубежной SIM-карты, что может быть проблемой для некоторых пользователей.
- **Платные API-ключи:** Бесплатные версии OpenAI имеют ограничения на количество токенов, что может быть недостаточным для больших объемов данных.

### Выводы
Проект демонстрирует успешную интеграцию `Telethon` и `OpenAI` для создания умного бота в Telegram. Однако для стабильной работы рекомендуется использовать зарубежную SIM-карту или рассмотреть альтернативные решения для обработки текста.
